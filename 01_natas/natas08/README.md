# Level 7 - Level 8: Natas - OverTheWire

## Level Goal

Username: natas8
URL:      http://natas8.natas.labs.overthewire.org

## Solution
This level includes another `submit` form, with the source code available at `/index-source.html`. We can see the following PHP code:

```php
<?

$encodedSecret = "3d3d516343746d4d6d6c315669563362";

function encodeSecret($secret) {
    return bin2hex(strrev(base64_encode($secret)));
}

if(array_key_exists("submit", $_POST)) {
    if(encodeSecret($_POST['secret']) == $encodedSecret) {
    print "Access granted. The password for natas9 is <censored>";
    } else {
    print "Wrong secret";
    }
}
?>
```

This code is similar to how password hashing works in authentication, although these are very simple (and reversible) encoding methods.

The code has hardcoded the `$encodedSecret` variable, think of this as a "hashed" password entry in a database. The webserver will take the submitted value in the `POST` request (`$secret`), and send that through the `encodeSecret` function.

This function sends the input through several iterations of various encoding methods, and returns the encoded value. The code will then compare the encoded input with the hardcoded `$encodedSecret` variable value. If the two match, access will be granted.

We can identify what the correct password will be by doing some reverse engineering in the correct (reverse) order.

## bin2hex

Firstly, the `bin2hex` PHP function takes a binary string as input and returns its hexadecimal representation. In this case, it takes the reversed base64 encoded string from step 2 and returns its hexadecimal representation.

To reverse this, we'll have to run `xxd -r -p` on `3d3d516343746d4d6d6c315669563362`. The `xxd` command may not come preinstalled with your distribution (refer to your package manager for installing). 

```bash
└─$ echo "3d3d516343746d4d6d6c315669563362" | xxd -r -p
==QcCtmMml1ViV3b
```
The `xxd` command is used to make a hexdump of a given input. We add the `-r` flag to reverse the hex dump generated by the xxd utility back into its original binary form. Next, the `-p` option stands for plain, which produces a plain hex dump of the input data, without any header or footer information.

We now have a reversed base64 output.

## strrev
`strrev` is a PHP function that simply reverses a string. Essentially, `Hello World!` becomes `!dlroW olleH`. In this case, it takes the base64 encoded string from step 1 and returns the reversed version of it.

We can recreate (and reverse engineer) this in Bash with the `rev` command. We can append this to the above command to output valid base64:

```bash
└─$ echo "3d3d516343746d4d6d6c315669563362" | xxd -r -p | rev
b3ViV1lmMmtCcQ==
```

## base64
Lastly, now that we have valid base64, we can simply `decode` it using `base64 -d`:

```bash
└─$ echo "3d3d516343746d4d6d6c315669563362" | xxd -r -p | rev | base64 -d
oubWYf2kBq
```

We now have `oubWYf2kBq`, which appears to be the valid secret to submit to solve this level.

Putting it all together, we can simply make a `curl` `POST` request to retrieve the password:

```bash
└─$ curl -d "secret=oubWYf2kBq&submit=submit" -X POST http://natas8.natas.labs.overthewire.org/ -s -u natas8:a6bZCNYwdKqN5cGP11ZdtPg0iImQQhAB | grep password
Access granted. The password for natas9 is Sda6t0vkOPkM8YeOZkAGVhFoaplvlJFd
```